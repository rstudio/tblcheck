#' Apply automatic grading to a problem object
#'
#' @param problem A problem generated by a `tbl_check_*()` function.
#' @inheritParams tbl_check_table
#'
#' @return A [gradethis::fail()] message.
#' @export
#' 
#' @examples
#' .result <- 1:10
#' .solution <- letters[1:10]
#' problem <- tbl_check_vector()
#' tbl_grade(problem)
tbl_grade <- function(problem, max_diffs = 3) {
  if (is.null(problem)) {
    return(invisible())
  }
  
  assert_internally({
    checkmate::assert_class(problem, "tblcheck_problem")
    checkmate::assert_number(max_diffs, lower = 1)
  })
  
  message <- tbl_message(problem, max_diffs = max_diffs)
  
  if (!is.null(message)) {
    return_fail(message, problem = problem)
  }
}

tbl_message <- function(problem, ...) {
  UseMethod("tbl_message")
}
